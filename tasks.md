# μƒκ°μµκ΄€ ν”„λ΅μ νΈ - λ³΄μ• κ°μ„  μ‘μ—…

## π“‹ μ‘μ—… κ°μ”
ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄λ“μ—μ„ Service Role Key λ…Έμ¶ λ¬Έμ λ¥Ό ν•΄κ²°ν•κ³  λ³΄μ• μ„λ²„μ‚¬μ΄λ“ μ—…λ΅λ“ μ‹μ¤ν…μ„ κµ¬ν„

## β… μ™„λ£λ μ‘μ—…

### 1. Next.js λΉλ“ λ¬Έμ  ν•΄κ²°
- **λ¬Έμ **: API routeμ™€ page νμΌμ΄ μ¶©λν•μ—¬ λΉλ“ μ‹¤ν¨
- **ν•΄κ²°**: μ¶©λν•λ” page.tsx νμΌλ“¤ μ κ±°
  - `src/app/api/auth/google/callback/page.tsx` μ‚­μ 
  - `src/app/auth/callback/page.tsx` μ‚­μ 
- **κ²°κ³Ό**: λΉλ“ μ„±κ³µ (ESLint κ²½κ³ λ” μμ§€λ§ κΈ°λ¥μ— μν–¥ μ—†μ)

### 2. λ³΄μ• μ—…λ΅λ“ μ‹μ¤ν… κµ¬ν„ λ° κ²€μ¦
- **κµ¬ν„ λ‚΄μ©**:
  - `/api/upload/images` - λ³΄μ• μ΄λ―Έμ§€ μ—…λ΅λ“ μ—”λ“ν¬μΈνΈ
  - `/api/upload/simple` - κ°„λ‹¨ν• ν…μ¤νΈμ© μ—…λ΅λ“ μ—”λ“ν¬μΈνΈ
  - `src/lib/upload.ts` - μ—…λ΅λ“ μ ν‹Έλ¦¬ν‹° ν•¨μλ“¤
- **λ³΄μ• κ°μ„ μ‚¬ν•­**:
  - Service Role Keyκ°€ μ„λ²„μ‚¬μ΄λ“μ—μ„λ§ μ‚¬μ©λ¨
  - νμΌ νƒ€μ…, ν¬κΈ°, κ°μ κ²€μ¦
  - λ³΄μ• νμΌλ… μƒμ„± (UUID κΈ°λ°)
  - κµ¬μ΅°ν™”λ μ¤ν† λ¦¬μ§€ κ²½λ΅

### 3. ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈ λ³΄μ• ν™•μΈ
- **κ²€μ¦ κ²°κ³Ό**:
  - ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈμ—μ„ Service Role Key μ§μ ‘ μ‚¬μ© μ—†μ
  - `photoUpload.ts` - ν΄λΌμ΄μ–ΈνΈ μ ν‹Έλ¦¬ν‹°λ§ ν¬ν•¨
  - `PhotoJournalForm.tsx` - API νΈμ¶μ„ ν†µν• μ—…λ΅λ“
  - `SimplePhotoJournalForm.tsx` - API νΈμ¶μ„ ν†µν• μ—…λ΅λ“

### 4. ν…μ¤νΈ νμ΄μ§€ λ° μ¤ν¬λ¦½νΈ μƒμ„±
- **ν…μ¤νΈ νμ΄μ§€**: `/simple-test` - μ—…λ΅λ“ κΈ°λ¥ ν…μ¤νΈμ©
- **ν…μ¤νΈ μ¤ν¬λ¦½νΈ**: `test-upload-api.js` - API μ§μ ‘ ν…μ¤νΈμ©

## π”’ λ³΄μ• μ•„ν‚¤ν…μ²

```
ν΄λΌμ΄μ–ΈνΈ (λΈλΌμ°μ €/μ•±)
    β†“ FormData (μ΄λ―Έμ§€ νμΌ)
μ„λ²„μ‚¬μ΄λ“ API (/api/upload/*)
    β†“ Service Role Key μ‚¬μ©
Supabase Storage
    β†“ κ³µκ° URL λ°ν™
ν΄λΌμ΄μ–ΈνΈ
```

## π“ μ£Όμ” νμΌ κµ¬μ΅°

```
src/
β”β”€β”€ app/
β”‚   β”β”€β”€ api/
β”‚   β”‚   β””β”€β”€ upload/
β”‚   β”‚       β”β”€β”€ images/
β”‚   β”‚       β”‚   β””β”€β”€ route.ts      # λ³΄μ• μ—…λ΅λ“ API
β”‚   β”‚       β””β”€β”€ simple/
β”‚   β”‚           β””β”€β”€ route.ts      # κ°„λ‹¨ν• ν…μ¤νΈ API
β”‚   β””β”€β”€ simple-test/
β”‚       β””β”€β”€ page.tsx              # ν…μ¤νΈ νμ΄μ§€
β”β”€β”€ lib/
β”‚   β””β”€β”€ upload.ts                 # μ—…λ΅λ“ μ ν‹Έλ¦¬ν‹°
β””β”€β”€ utils/
    β””β”€β”€ photoUpload.ts            # ν΄λΌμ΄μ–ΈνΈ μ ν‹Έλ¦¬ν‹°
```

## π€ μ‚¬μ© λ°©λ²•

1. **κ°λ° μ„λ²„ μ‹¤ν–‰**
   ```bash
   npm run dev
   ```

2. **ν…μ¤νΈ νμ΄μ§€ μ ‘μ†**
   - http://localhost:3000/simple-test

3. **API μ§μ ‘ ν…μ¤νΈ**
   ```bash
   node test-upload-api.js
   ```

## β οΈ μ£Όμμ‚¬ν•­

1. **ν™κ²½λ³€μ μ„¤μ • ν•„μ**
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - `SUPABASE_SERVICE_ROLE_KEY` (μ„λ²„μ‚¬μ΄λ“ μ „μ©)

2. **Service Role Key λ³΄μ•**
   - μ λ€ ν΄λΌμ΄μ–ΈνΈ μ½”λ“μ— ν¬ν•¨ν•μ§€ λ§ κ²ƒ
   - ν™κ²½λ³€μλ΅λ§ κ΄€λ¦¬
   - μ„λ²„μ‚¬μ΄λ“ APIμ—μ„λ§ μ‚¬μ©

3. **μ¤ν† λ¦¬μ§€ λ²„ν‚· μ„¤μ •**
   - `journal-images` λ²„ν‚·μ΄ μƒμ„±λμ–΄ μμ–΄μ•Ό ν•¨
   - μ μ ν• RLS μ •μ±… μ„¤μ • ν•„μ”

## π”§ μ¶”κ°€ κ°μ„  κ°€λ¥ μ‚¬ν•­

1. **μ‚¬μ©μ μΈμ¦ μ¶”κ°€**
   - ν„μ¬λ” userIdλ¥Ό ν΄λΌμ΄μ–ΈνΈμ—μ„ μ „μ†΅
   - JWT ν† ν° κΈ°λ° μΈμ¦ μ¶”κ°€ κ¶μ¥

2. **μ΄λ―Έμ§€ μµμ ν™”**
   - μ„λ²„μ‚¬μ΄λ“ μ΄λ―Έμ§€ λ¦¬μ‚¬μ΄μ§•
   - WebP λ³€ν™
   - μΈλ„¤μΌ μƒμ„±

3. **μ—…λ΅λ“ μ§„ν–‰λ¥  ν‘μ‹**
   - λ€μ©λ‰ νμΌ μ—…λ΅λ“ μ‹ μ§„ν–‰λ¥  ν‘μ‹
   - μ²­ν¬ μ—…λ΅λ“ κµ¬ν„

4. **μ—λ¬ μ²λ¦¬ κ°•ν™”**
   - λ” μμ„Έν• μ—λ¬ λ©”μ‹μ§€
   - μ¬μ‹λ„ λ΅μ§
   - μ¤ν”„λΌμΈ λ€μ‘