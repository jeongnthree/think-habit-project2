<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Placeholder URL ìˆ˜ì • ë„êµ¬</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .section h3 {
            margin-top: 0;
            color: #555;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .danger {
            background-color: #f44336;
        }
        .danger:hover {
            background-color: #da190b;
        }
        .info {
            background-color: #2196F3;
        }
        .info:hover {
            background-color: #0b7dda;
        }
        .log {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .count {
            font-weight: bold;
            color: #2196F3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Placeholder URL ìˆ˜ì • ë„êµ¬</h1>
        
        <div class="section">
            <h3>ğŸ“Š í˜„ì¬ ìƒíƒœ í™•ì¸</h3>
            <button onclick="checkPlaceholderUrls()" class="info">Placeholder URL í™•ì¸</button>
            <button onclick="checkLocalStorage()" class="info">LocalStorage í™•ì¸</button>
            <div id="status-log" class="log"></div>
        </div>
        
        <div class="section">
            <h3>ğŸ”„ ìˆ˜ì • ì‘ì—…</h3>
            <button onclick="fixPlaceholderUrls()">Placeholder URL ìˆ˜ì •</button>
            <button onclick="clearBadData()" class="danger">ë¬¸ì œ ë°ì´í„° ì‚­ì œ</button>
            <button onclick="clearAllStorage()" class="danger">ì „ì²´ Storage ì´ˆê¸°í™”</button>
        </div>
        
        <div class="section">
            <h3>ğŸ“ ì‘ì—… ë¡œê·¸</h3>
            <div id="action-log" class="log"></div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logContainer = document.getElementById('action-log');
            const timestamp = new Date().toLocaleTimeString();
            logContainer.textContent += `[${timestamp}] ${message}\n`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function statusLog(message) {
            const statusContainer = document.getElementById('status-log');
            statusContainer.textContent += message + '\n';
        }

        function checkPlaceholderUrls() {
            document.getElementById('status-log').textContent = '';
            statusLog('ğŸ” Placeholder URL ê²€ì‚¬ ì¤‘...\n');
            
            // localStorage ê²€ì‚¬
            const journals = JSON.parse(localStorage.getItem('journals') || '[]');
            let placeholderCount = 0;
            let totalImages = 0;
            
            statusLog(`ğŸ“š ì €ì¥ëœ ì¼ì§€ ê°œìˆ˜: ${journals.length}\n`);
            
            journals.forEach((journal, index) => {
                if (journal.attachments && journal.attachments.length > 0) {
                    totalImages += journal.attachments.length;
                    journal.attachments.forEach((url, imgIndex) => {
                        if (url.includes('via.placeholder.com')) {
                            placeholderCount++;
                            statusLog(`âŒ ì¼ì§€ ${index + 1} "${journal.title}" - ì´ë¯¸ì§€ ${imgIndex + 1}: ${url}`);
                        }
                    });
                }
                
                if (journal.image_urls && journal.image_urls.length > 0) {
                    totalImages += journal.image_urls.length;
                    journal.image_urls.forEach((url, imgIndex) => {
                        if (url.includes('via.placeholder.com')) {
                            placeholderCount++;
                            statusLog(`âŒ ì¼ì§€ ${index + 1} "${journal.title}" - image_urls ${imgIndex + 1}: ${url}`);
                        }
                    });
                }
            });
            
            statusLog(`\nğŸ“Š ê²€ì‚¬ ê²°ê³¼:`);
            statusLog(`- ì „ì²´ ì´ë¯¸ì§€: ${totalImages}ê°œ`);
            statusLog(`- Placeholder URL: ${placeholderCount}ê°œ`);
            
            if (placeholderCount > 0) {
                statusLog(`\nâš ï¸ ${placeholderCount}ê°œì˜ ë¬¸ì œ URLì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!`);
            } else {
                statusLog(`\nâœ… ë¬¸ì œ URLì´ ì—†ìŠµë‹ˆë‹¤.`);
            }
        }

        function checkLocalStorage() {
            document.getElementById('status-log').textContent = '';
            statusLog('ğŸ” LocalStorage ì „ì²´ ê²€ì‚¬ ì¤‘...\n');
            
            Object.keys(localStorage).forEach(key => {
                const value = localStorage.getItem(key);
                if (value && value.includes('via.placeholder.com')) {
                    statusLog(`âŒ Key "${key}"ì—ì„œ placeholder URL ë°œê²¬`);
                    statusLog(`   ë‚´ìš©: ${value.substring(0, 100)}...`);
                }
            });
            
            statusLog('\nâœ… LocalStorage ê²€ì‚¬ ì™„ë£Œ');
        }

        function fixPlaceholderUrls() {
            log('ğŸ”§ Placeholder URL ìˆ˜ì • ì‹œì‘...');
            
            const journals = JSON.parse(localStorage.getItem('journals') || '[]');
            let fixedCount = 0;
            
            const updatedJournals = journals.map(journal => {
                let modified = false;
                
                // attachments ìˆ˜ì •
                if (journal.attachments && journal.attachments.length > 0) {
                    journal.attachments = journal.attachments.map(url => {
                        if (url.includes('via.placeholder.com')) {
                            fixedCount++;
                            modified = true;
                            return '/images/upload-failed.svg';
                        }
                        return url;
                    });
                }
                
                // image_urls ìˆ˜ì •
                if (journal.image_urls && journal.image_urls.length > 0) {
                    journal.image_urls = journal.image_urls.map(url => {
                        if (url.includes('via.placeholder.com')) {
                            fixedCount++;
                            modified = true;
                            return '/images/upload-failed.svg';
                        }
                        return url;
                    });
                }
                
                if (modified) {
                    log(`ğŸ“ ì¼ì§€ "${journal.title}" ìˆ˜ì •ë¨`);
                }
                
                return journal;
            });
            
            localStorage.setItem('journals', JSON.stringify(updatedJournals));
            log(`âœ… ìˆ˜ì • ì™„ë£Œ: ${fixedCount}ê°œ URLì´ ë¡œì»¬ ì´ë¯¸ì§€ë¡œ ë³€ê²½ë¨`);
            log('ğŸ”„ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë³€ê²½ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”.');
        }

        function clearBadData() {
            if (!confirm('ë¬¸ì œê°€ ìˆëŠ” ì¼ì§€ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            log('ğŸ—‘ï¸ ë¬¸ì œ ë°ì´í„° ì‚­ì œ ì¤‘...');
            
            const journals = JSON.parse(localStorage.getItem('journals') || '[]');
            const cleanJournals = journals.filter(journal => {
                const hasBadUrl = (journal.attachments && journal.attachments.some(url => url.includes('via.placeholder.com'))) ||
                                 (journal.image_urls && journal.image_urls.some(url => url.includes('via.placeholder.com')));
                
                if (hasBadUrl) {
                    log(`ğŸ—‘ï¸ ì‚­ì œ: "${journal.title}"`);
                    return false;
                }
                return true;
            });
            
            localStorage.setItem('journals', JSON.stringify(cleanJournals));
            log(`âœ… ì •ë¦¬ ì™„ë£Œ: ${journals.length - cleanJournals.length}ê°œ ì¼ì§€ ì‚­ì œë¨`);
        }

        function clearAllStorage() {
            if (!confirm('ëª¨ë“  ì €ì¥ëœ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) return;
            
            log('ğŸ§¹ ì „ì²´ Storage ì´ˆê¸°í™” ì¤‘...');
            localStorage.clear();
            log('âœ… ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ê²€ì‚¬
        window.addEventListener('load', () => {
            log('ğŸš€ Placeholder URL ìˆ˜ì • ë„êµ¬ ë¡œë“œë¨');
            checkPlaceholderUrls();
        });
    </script>
</body>
</html>