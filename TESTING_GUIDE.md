# 🧪 보안 업로드 시스템 테스트 가이드

## 1. 개발 서버 실행

```bash
# 터미널에서 실행
npm run dev
```

서버가 실행되면 `http://localhost:3000`에서 접근 가능합니다.

## 2. 단계별 테스트 경로

### Step 1: 메인 훈련 페이지 접근

```
http://localhost:3000/training
```

- 할당된 카테고리 목록이 표시됩니다
- "새 일지 작성" 버튼을 클릭합니다

### Step 2: 일지 타입 선택 페이지

```
http://localhost:3000/training/journal/new?categoryId=550e8400-e29b-41d4-a716-446655440001
```

- 구조화된 일지 vs 사진 일지 선택
- **"사진 일지"를 선택**하여 업로드 기능 테스트

### Step 3: 사진 일지 작성 페이지 (보안 업로드 테스트)

```
http://localhost:3000/training/journal/new/photo?categoryId=550e8400-e29b-41d4-a716-446655440001
```

## 3. 보안 업로드 기능 테스트

### 3.1 정상 업로드 테스트

1. **사진 선택**: "사진 선택" 버튼 클릭
2. **이미지 파일 선택**: JPG, PNG, WebP 등
3. **제목 입력**: 일지 제목 작성
4. **내용 입력**: 최소 10자 이상 작성
5. **일지 저장**: "일지 저장" 버튼 클릭

### 3.2 파일 검증 테스트

다음 파일들로 제한 테스트:

- ✅ **허용**: JPG, PNG, WebP, GIF (10MB 이하)
- ❌ **거부**: PDF, TXT, 동영상 파일
- ❌ **거부**: 10MB 초과 파일
- ❌ **거부**: 6개 이상 파일

### 3.3 보안 검증 테스트

브라우저 개발자 도구에서:

1. **F12** 키로 개발자 도구 열기
2. **Network 탭** 확인
3. 파일 업로드 시 `/api/upload/images` 호출 확인
4. **Service Role Key가 노출되지 않는지** 확인

## 4. 보안 테스트 스크립트 실행

```bash
# 보안 검증 스크립트 실행
node scripts/testing/security-test.js
```

## 5. 예상 결과

### 성공적인 업로드 시:

- ✅ 파일이 Supabase Storage에 업로드됨
- ✅ 보안 파일명으로 저장됨 (예: `1234567890-abc123.jpg`)
- ✅ 구조화된 경로에 저장됨 (`userId/2024/01/journalId/filename`)
- ✅ 일지 저장 완료 화면 표시

### 보안 검증 결과:

- ✅ Service Role Key가 클라이언트에 노출되지 않음
- ✅ 모든 업로드가 서버사이드 API를 통해 처리됨
- ✅ 파일 검증이 클라이언트와 서버 양쪽에서 수행됨

## 6. 문제 해결

### 404 오류 발생 시:

1. **개발 서버 재시작**:

   ```bash
   # Ctrl+C로 서버 중단 후
   npm run dev
   ```

2. **URL 확인**: 위의 정확한 URL 사용

3. **브라우저 캐시 삭제**: Ctrl+Shift+R (강력 새로고침)

### 업로드 실패 시:

1. **환경변수 확인**: `.env.local`에 `SUPABASE_SERVICE_ROLE_KEY` 설정
2. **Supabase 연결 확인**: 네트워크 연결 상태 점검
3. **콘솔 로그 확인**: 브라우저 개발자 도구 Console 탭

## 7. 테스트 체크리스트

### 기능 테스트

- [ ] 사진 선택 기능 작동
- [ ] 파일 미리보기 표시
- [ ] 파일 제거 기능 작동
- [ ] 제목/내용 입력 가능
- [ ] 공개/비공개 설정 가능
- [ ] 일지 저장 성공

### 보안 테스트

- [ ] Service Role Key 클라이언트 노출 없음
- [ ] 서버사이드 API 호출 확인
- [ ] 파일 검증 작동 (크기, 타입, 개수)
- [ ] 보안 파일명 생성 확인
- [ ] 구조화된 스토리지 경로 확인

### 오류 처리 테스트

- [ ] 잘못된 파일 형식 업로드 시 오류 메시지
- [ ] 큰 파일 업로드 시 오류 메시지
- [ ] 너무 많은 파일 업로드 시 오류 메시지
- [ ] 네트워크 오류 시 적절한 처리

## 8. 성능 테스트

### 다중 파일 업로드

- 5개 파일 동시 업로드 테스트
- 각각 다른 크기의 파일로 테스트
- 업로드 진행 상태 확인

### 대용량 파일 테스트

- 9MB 파일 업로드 (성공해야 함)
- 11MB 파일 업로드 (실패해야 함)

이 가이드를 따라 테스트하시면 보안 업로드 시스템이 올바르게 작동하는지 확인할 수 있습니다! 🚀
